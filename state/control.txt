(* ----- CONTROL MODULE ----- *)
CONTROL

EXTVAR
(* Controlling values at each step:
 * A variable must be declared here with a type and default value in order to
 * control its value at each step. Then, in the EXEC section, set the value for
 * a simulation step like this:
 *     var[0] := value;
 *)

STOREVAR

VAR

CONST

DEFINE

EXEC
(* To keep output clean and to keep test and assertions from interfering with
 * eachother, only uncomment one of the blocks below:
 *)

(* Test the case statement for cs_selector *)

simulate(1);
decide(State.cs_selector = syscallInstr.cs_selector);
simulate(1);
decide(State.cs_selector = sysretInstr.cs_selector);


(* Make sure exception_raised forces the next instruction to "exception" *)
(*
simulate(1);
simulate(1);
*)

(* Privileged exception handlers must run with ring0 stack.
 * This is the OS expectation that exposed the sysret bug.
 *)
simulate(1);
simulate(1);
simulate(1);
